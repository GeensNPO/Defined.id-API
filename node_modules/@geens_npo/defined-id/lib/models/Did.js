"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Did = void 0;
const v4 = require("uuid/v4");
const __1 = require("..");
class Did {
    constructor(method, nemPublicKey, salt) {
        this.method = method;
        this.nemPublicKey = nemPublicKey;
        if (!salt)
            this.salt = v4();
        else
            this.salt = salt;
    }
    format() {
        const errors = __1.DidValidator.validateDidModel(this);
        if (errors.length > 0)
            throw new Error(errors.join());
        return `did:${this.method}:${this.generateIdentifier()}`;
    }
    generateIdentifier() {
        //Make sure the public key is lowercase before using it
        const pk = this.nemPublicKey.toLowerCase();
        return __1.SecurityService.base58CheckEncode(__1.SecurityService.ripemd160Hash(__1.SecurityService.sha256StringHash(`${this.salt}${pk}`)));
    }
}
exports.Did = Did;
